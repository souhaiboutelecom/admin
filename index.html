<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOUHAIBOU TÉLÉCOM - Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1428A0;
            --secondary: #FF6B00;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --white: #ffffff;
            --sidebar-width: 250px;
            --header-height: 60px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: #333;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.2rem;
            margin-top: 10px;
        }

        .sidebar-menu {
            padding: 15px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid var(--secondary);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: all 0.3s ease;
        }

        /* Header */
        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-badge {
            position: relative;
            cursor: pointer;
        }

        .notification-badge i {
            font-size: 1.2rem;
            color: var(--gray);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1rem;
            color: var(--gray);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-footer {
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Charts */
        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--light);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        /* Buttons */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            display: none;
        }

        .modal {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #1a3ac5 100%);
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-top: 10px;
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .text-success {
            color: var(--success);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-warning {
            color: var(--warning);
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                overflow: visible;
            }

            .sidebar-header h2, .menu-item span {
                display: none;
            }

            .menu-item {
                justify-content: center;
                padding: 15px;
            }

            .menu-item i {
                margin-right: 0;
            }

            .main-content {
                margin-left: 70px;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .charts-container {
                grid-template-columns: 1fr !important;
            }

            canvas {
                max-height: 250px !important;
            }
        }

        /* Page specific styles */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .filter-bar {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            height: 180px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-price {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-stock {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-badge {
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .stock-low {
            background: #fff0f0;
            color: var(--danger);
        }

        .stock-medium {
            background: #fff9eb;
            color: var(--warning);
        }

        .stock-high {
            background: #f0f9f0;
            color: var(--success);
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            padding-left: 45px;
            border: 1px solid #ddd;
            border-radius: 30px;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
        }

        .product-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .product-actions button {
            padding: 5px;
            font-size: 0.8rem;
        }

        .notification-page {
            padding: 20px;
        }

        .notification-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .characteristics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .download-btn {
            margin-top: 10px;
        }

        .security-login {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 300px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr !important;
            }
            canvas {
                height: 200px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-store" style="font-size: 3rem; color: var(--primary);"></i>
                <h1>SOUHAIBOU TÉLÉCOM</h1>
                <p>Espace Administrateur</p>
            </div>
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" id="login-password" class="form-control" placeholder="Entrez le mot de passe">
            </div>
            <button id="login-btn" class="btn btn-primary" style="width: 100%;">Se connecter</button>
            <p id="login-error" class="text-danger" style="margin-top: 15px; display: none;">Mot de passe incorrect</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="app-container hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-store" style="font-size: 2rem;"></i>
                <h2>SOUHAIBOU TÉLÉCOM</h2>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Tableau de bord</span>
                </div>
                <div class="menu-item" data-page="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Commandes</span>
                </div>
                <div class="menu-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Produits</span>
                </div>
                <div class="menu-item" data-page="stats">
                    <i class="fas fa-chart-line"></i>
                    <span>Statistiques</span>
                </div>
                <div class="menu-item" data-page="security">
                    <i class="fas fa-lock"></i>
                    <span>Sécurité</span>
                </div>
                <div class="menu-item" id="notifications-menu">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </div>
                <div class="menu-item" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Déconnexion</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title" id="page-title">Tableau de bord</div>
                <div class="header-actions">
                    <div class="notification-badge" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="notification-count">0</span>
                    </div>
                    <div class="user-profile">
                        <div class="user-avatar">A</div>
                        <div>Admin</div>
                    </div>
                </div>
            </div>

            <!-- Pages -->
            <div id="dashboard-page" class="page active">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Commandes aujourd'hui</div>
                            <div class="card-icon" style="background: rgba(20, 40, 160, 0.1); color: var(--primary);">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value" id="today-orders">0</div>
                        <div class="card-footer">+0% depuis hier</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Revenu aujourd'hui</div>
                            <div class="card-icon" style="background: rgba(40, 167, 69, 0.1); color: var(--success);">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="today-revenue">0 FCFA</div>
                        <div class="card-footer">+0% depuis hier</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Commandes en attente</div>
                            <div class="card-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pending-orders">0</div>
                        <div class="card-footer">En attente de validation</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Produits en stock bas</div>
                            <div class="card-icon" style="background: rgba(220, 53, 69, 0.1); color: var(--danger);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="card-value" id="low-stock">0</div>
                        <div class="card-footer">Nécessitent réapprovisionnement</div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Ventes des 7 derniers jours</h3>
                            <select class="filter-select">
                                <option>7 jours</option>
                                <option>30 jours</option>
                                <option>90 jours</option>
                            </select>
                        </div>
                        <canvas id="sales-chart" height="300"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Catégories populaires</h3>
                        </div>
                        <canvas id="categories-chart" height="300"></canvas>
                    </div>
                </div>

                <div class="table-container">
                    <h3 class="mb-20">Dernières commandes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders">
                            <tr>
                                <td colspan="6" class="text-center">Aucune commande récente</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="orders-page" class="page">
                <div class="filter-bar">
                    <select id="order-status-filter" class="filter-select">
                        <option value="all">Toutes les commandes</option>
                        <option value="pending">En attente</option>
                        <option value="completed">Validées</option>
                        <option value="rejected">Rejetées</option>
                    </select>
                    <input type="date" id="order-date-filter" class="filter-select">
                    <div class="search-container" style="flex: 1;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="order-search" class="search-input" placeholder="Rechercher une commande...">
                    </div>
                    <button class="btn btn-primary download-btn" id="download-validated">Télécharger Validées (PDF)</button>
                    <button class="btn btn-danger download-btn" id="download-rejected">Télécharger Rejetées (PDF)</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Téléphone</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table">
                            <tr>
                                <td colspan="7" class="text-center">Aucune commande</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="products-page" class="page">
                <div class="filter-bar">
                    <select id="product-category-filter" class="filter-select">
                        <option value="all">Toutes les catégories</option>
                        <option value="iphone">iPhone</option>
                        <option value="samsung">Samsung</option>
                        <option value="tecno">Tecno</option>
                        <option value="ecouteur">Écouteur</option>
                        <option value="chargeur">Chargeur</option>
                        <option value="powerbank">Power Bank</option>
                        <option value="tablette">Tablette</option>
                        <option value="ordinateur">Ordinateur</option>
                        <option value="box">Box</option>
                        <option value="smartwatch">Smart Watch</option>
                    </select>
                    <select id="product-stock-filter" class="filter-select">
                        <option value="all">Tous les stocks</option>
                        <option value="low">Stock bas</option>
                        <option value="medium">Stock moyen</option>
                        <option value="high">Stock élevé</option>
                    </select>
                    <div class="search-container" style="flex: 1;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="product-search" class="search-input" placeholder="Rechercher un produit...">
                    </div>
                    <button class="btn btn-primary" id="add-product-btn">Ajouter un produit</button>
                </div>

                <div class="product-grid" id="products-grid">
                    <div class="text-center">Chargement des produits...</div>
                </div>
            </div>

            <div id="stats-page" class="page">
                <div class="filter-bar">
                    <select id="stats-period" class="filter-select">
                        <option value="day">Aujourd'hui</option>
                        <option value="week">Cette semaine</option>
                        <option value="month">Ce mois</option>
                        <option value="year">Cette année</option>
                    </select>
                    <input type="date" id="stats-start-date" class="filter-select">
                    <input type="date" id="stats-end-date" class="filter-select">
                    <button class="btn btn-primary">Appliquer</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Commandes</div>
                        <div class="stat-value" id="stats-orders">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Revenu</div>
                        <div class="stat-value" id="stats-revenue">0 FCFA</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Produits vendus</div>
                        <div class="stat-value" id="stats-products-sold">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Panier moyen</div>
                        <div class="stat-value" id="stats-avg-cart">0 FCFA</div>
                        <div class="stat-label">Moyenne</div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Évolution des ventes</h3>
                        </div>
                        <canvas id="stats-sales-chart" height="300"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Top produits</h3>
                        </div>
                        <canvas id="stats-products-chart" height="300"></canvas>
                    </div>
                </div>

                <div class="table-container">
                    <h3 class="mb-20">Détails des ventes <button class="btn btn-danger btn-sm" id="delete-all-sales">Supprimer tous</button></h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Produit</th>
                                <th>Quantité vendue</th>
                                <th>Revenu</th>
                                <th>Stock restant</th>
                            </tr>
                        </thead>
                        <tbody id="sales-details">
                            <tr>
                                <td colspan="4" class="text-center">Aucune donnée</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="notifications-page" class="page">
                <div class="notification-page">
                    <h3>Notifications (Commandes en attente)</h3>
                    <div id="notifications-list"></div>
                </div>
            </div>

            <div id="security-page" class="page">
                <div class="security-login">
                    <h3>Accès aux paramètres de sécurité</h3>
                    <div class="form-group">
                        <label class="form-label">Mot de passe sécurité (1111)</label>
                        <input type="password" id="security-password" class="form-control" placeholder="Entrez le mot de passe">
                    </div>
                    <button id="security-login-btn" class="btn btn-primary" style="width: 100%;">Accéder</button>
                    <p id="security-error" class="text-danger" style="margin-top: 15px; display: none;">Mot de passe incorrect</p>
                </div>
                <div id="security-content" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3>Paramètres de sécurité</h3>
                        </div>
                        <div class="card-body" style="padding: 20px;">
                            <div class="form-group">
                                <label class="form-label">Mot de passe administrateur</label>
                                <input type="password" id="admin-password" class="form-control" value="0000">
                                <small>Le mot de passe pour accéder à l'interface d'administration</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Code de suppression</label>
                                <input type="password" id="delete-code" class="form-control" value="0000">
                                <small>Le code requis pour supprimer des éléments</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mot de passe sécurité</label>
                                <input type="password" id="security-password-admin" class="form-control" value="1111">
                                <small>Mot de passe pour accéder à la page sécurité</small>
                            </div>
                            <button class="btn btn-primary" id="save-security">Enregistrer les paramètres</button>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3>Journal d'activité</h3>
                        </div>
                        <div class="card-body" style="padding: 20px;">
                            <button class="btn btn-danger" id="delete-log">Supprimer le journal</button>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Utilisateur</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-log">
                                    <tr>
                                        <td colspan="3" class="text-center">Aucune activité récente</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="order-detail-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Détails de la commande</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="order-detail-content">
                Chargement...
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="validate-order-btn">Valider</button>
                <button class="btn btn-danger" id="reject-order-btn">Rejeter</button>
                <button class="btn btn-primary" id="close-order-btn">Fermer</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="product-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="product-modal-title">Ajouter un produit</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom du produit</label>
                    <input type="text" class="form-control" id="product-name">
                </div>
                <div class="form-group">
                    <label class="form-label">Marque</label>
                    <input type="text" class="form-control" id="product-brand">
                </div>
                <div class="form-group">
                    <label class="form-label">Catégorie</label>
                    <select class="form-control" id="product-category">
                        <option value="iphone">iPhone</option>
                        <option value="samsung">Samsung</option>
                        <option value="tecno">Tecno</option>
                        <option value="ecouteur">Écouteur</option>
                        <option value="chargeur">Chargeur</option>
                        <option value="powerbank">Power Bank</option>
                        <option value="tablette">Tablette</option>
                        <option value="ordinateur">Ordinateur</option>
                        <option value="box">Box</option>
                        <option value="smartwatch">Smart Watch</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Prix normal (FCFA)</label>
                    <input type="number" class="form-control" id="product-normal-price">
                </div>
                <div class="form-group">
                    <label class="form-label">Prix réduit (FCFA)</label>
                    <input type="number" class="form-control" id="product-sale-price">
                </div>
                <div class="form-group">
                    <label class="form-label">Pourcentage de réduction (%)</label>
                    <input type="number" class="form-control" id="product-discount" min="0" max="100">
                </div>
                <div class="form-group">
                    <label class="form-label">Stock initial</label>
                    <input type="number" class="form-control" id="product-stock">
                </div>
                <div class="form-group">
                    <label class="form-label">Livraison</label>
                    <select class="form-control" id="product-delivery">
                        <option value="free">Gratuite</option>
                        <option value="paid">Payante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="product-flash-sale"> Inclure dans les ventes flash
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">Caractéristiques</label>
                    <div class="characteristics-grid">
                        <div class="form-group">
                            <label>OS</label>
                            <input type="text" class="form-control" id="char-os">
                        </div>
                        <div class="form-group">
                            <label>Stockage</label>
                            <input type="text" class="form-control" id="char-storage">
                        </div>
                        <div class="form-group">
                            <label>RAM</label>
                            <input type="text" class="form-control" id="char-ram">
                        </div>
                        <div class="form-group">
                            <label>Taille écran</label>
                            <input type="text" class="form-control" id="char-screen">
                        </div>
                        <div class="form-group">
                            <label>Modèle</label>
                            <input type="text" class="form-control" id="char-model">
                        </div>
                        <div class="form-group">
                            <label>Technologie</label>
                            <input type="text" class="form-control" id="char-tech">
                        </div>
                        <div class="form-group">
                            <label>Couleurs</label>
                            <input type="text" class="form-control" id="char-colors">
                        </div>
                        <div class="form-group">
                            <label>Batterie</label>
                            <input type="text" class="form-control" id="char-battery">
                        </div>
                        <div class="form-group">
                            <label>Caméra</label>
                            <input type="text" class="form-control" id="char-camera">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description du produit</label>
                    <textarea class="form-control" id="product-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Image principale (URL)</label>
                    <input type="url" class="form-control" id="product-main-image" placeholder="https://...">
                    <div class="image-preview" id="main-image-preview"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Images supplémentaires (URLs séparées par des virgules)</label>
                    <input type="text" class="form-control" id="product-additional-images" placeholder="https://..., https://...">
                    <div class="image-preview" id="additional-images-preview"></div>
                    <button type="button" class="btn btn-secondary btn-sm" id="add-image-btn">+ Ajouter une image</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="save-product-btn">Enregistrer</button>
                <button class="btn btn-secondary" id="cancel-product-btn">Annuler</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="delete-confirm-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Confirmation de suppression</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Êtes-vous sûr de vouloir supprimer cet élément ?</p>
                <div class="form-group">
                    <label class="form-label">Code de suppression</label>
                    <input type="password" class="form-control" id="delete-confirm-code">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="confirm-delete-btn">Supprimer</button>
                <button class="btn btn-secondary" id="cancel-delete-btn">Annuler</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDfJwZNAtT5u9sKdw7R2J7QOcohf2_03Vk",
            authDomain: "souhaibou-4883d.firebaseapp.com",
            projectId: "souhaibou-4883d",
            storageBucket: "souhaibou-4883d.firebasestorage.app",
            messagingSenderId: "703566382245",
            appId: "1:703566382245:web:82e265798635786bb8794c",
            measurementId: "G-SW6XGD9YHY"
        };

        // Initialisation Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Variables globales
        let adminPassword = "0000";
        let deleteCode = "0000";
        let securityPassword = "1111";
        let currentUser = null;
        let orders = [];
        let products = [];
        let notifications = [];
        let authTimeout = 3 * 60 * 60 * 1000; // 3 hours
        let editingProductId = null;

        // Éléments DOM
        const elements = {
            loginPage: document.getElementById('login-page'),
            appContainer: document.getElementById('app-container'),
            loginPassword: document.getElementById('login-password'),
            loginBtn: document.getElementById('login-btn'),
            loginError: document.getElementById('login-error'),
            pageTitle: document.getElementById('page-title'),
            pages: document.querySelectorAll('.page'),
            menuItems: document.querySelectorAll('.menu-item'),
            notificationCount: document.getElementById('notification-count'),
            notificationBell: document.getElementById('notification-bell'),
            todayOrders: document.getElementById('today-orders'),
            todayRevenue: document.getElementById('today-revenue'),
            pendingOrders: document.getElementById('pending-orders'),
            lowStock: document.getElementById('low-stock'),
            recentOrders: document.getElementById('recent-orders'),
            ordersTable: document.getElementById('orders-table'),
            productsGrid: document.getElementById('products-grid'),
            salesChart: document.getElementById('sales-chart'),
            categoriesChart: document.getElementById('categories-chart'),
            statsOrders: document.getElementById('stats-orders'),
            statsRevenue: document.getElementById('stats-revenue'),
            statsProductsSold: document.getElementById('stats-products-sold'),
            statsAvgCart: document.getElementById('stats-avg-cart'),
            salesDetails: document.getElementById('sales-details'),
            adminPasswordInput: document.getElementById('admin-password'),
            deleteCodeInput: document.getElementById('delete-code'),
            securityPasswordInput: document.getElementById('security-password-admin'),
            saveSecurityBtn: document.getElementById('save-security'),
            activityLog: document.getElementById('activity-log'),
            orderDetailModal: document.getElementById('order-detail-modal'),
            orderDetailContent: document.getElementById('order-detail-content'),
            productModal: document.getElementById('product-modal'),
            deleteConfirmModal: document.getElementById('delete-confirm-modal'),
            securityContent: document.getElementById('security-content'),
            securityLoginBtn: document.getElementById('security-login-btn'),
            securityError: document.getElementById('security-error'),
            securityPassword: document.getElementById('security-password'),
            notificationsList: document.getElementById('notifications-list'),
            downloadValidated: document.getElementById('download-validated'),
            downloadRejected: document.getElementById('download-rejected'),
            deleteAllSales: document.getElementById('delete-all-sales'),
            deleteLog: document.getElementById('delete-log')
        };

        // Initialisation de l'application
        function initApp() {
            setupEventListeners();
            checkAuthState();
        }

        // Vérification de l'état d'authentification
        function checkAuthState() {
            const savedAuth = localStorage.getItem('adminAuth');
            if (savedAuth) {
                const auth = JSON.parse(savedAuth);
                if (auth.loggedIn && (Date.now() - auth.timestamp) < authTimeout) {
                    showApp();
                    loadData();
                } else {
                    localStorage.removeItem('adminAuth');
                    showLogin();
                }
            } else {
                showLogin();
            }
        }

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            // Login
            elements.loginBtn.addEventListener('click', handleLogin);
            elements.loginPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });

            // Navigation
            elements.menuItems.forEach(item => {
                if (item.id !== 'logout-btn' && item.id !== 'notifications-menu') {
                    item.addEventListener('click', (e) => {
                        const pageId = item.getAttribute('data-page');
                        navigateTo(pageId);
                    });
                }
            });

            // Notifications menu
            document.getElementById('notifications-menu').addEventListener('click', () => navigateTo('notifications'));

            // Notification bell
            elements.notificationBell.addEventListener('click', () => navigateTo('notifications'));

            // Déconnexion
            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Sécurité
            elements.securityLoginBtn.addEventListener('click', handleSecurityLogin);
            elements.securityPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSecurityLogin();
            });
            elements.saveSecurityBtn.addEventListener('click', saveSecuritySettings);

            // Modales
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', closeModals);
            });

            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) closeModals();
                });
            });

            // Commandes
            document.getElementById('order-status-filter').addEventListener('change', filterOrders);
            document.getElementById('order-search').addEventListener('input', filterOrders);
            elements.downloadValidated.addEventListener('click', () => downloadOrders('completed'));
            elements.downloadRejected.addEventListener('click', () => downloadOrders('rejected'));

            // Produits
            document.getElementById('add-product-btn').addEventListener('click', () => showAddProductModal(null));
            document.getElementById('save-product-btn').addEventListener('click', saveProduct);
            document.getElementById('cancel-product-btn').addEventListener('click', closeModals);
            document.getElementById('product-category-filter').addEventListener('change', filterProducts);
            document.getElementById('product-stock-filter').addEventListener('change', filterProducts);
            document.getElementById('product-search').addEventListener('input', filterProducts);
            document.getElementById('product-main-image').addEventListener('input', previewMainImage);
            document.getElementById('product-additional-images').addEventListener('input', previewAdditionalImages);
            document.getElementById('add-image-btn').addEventListener('click', addImageInput);

            // Stats
            elements.deleteAllSales.addEventListener('click', deleteAllSales);

            // Security
            elements.deleteLog.addEventListener('click', deleteActivityLog);
        }

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => modal.style.display = 'none');
        }

        // Gestion de la connexion
        async function handleLogin() {
            const password = elements.loginPassword.value;
            const action = password === adminPassword ? 'success' : 'failed';
            await logActivity('Admin', `Tentative de connexion: ${action}`);
            
            if (password === adminPassword) {
                localStorage.setItem('adminAuth', JSON.stringify({
                    loggedIn: true,
                    timestamp: Date.now()
                }));
                showApp();
                loadData();
                elements.loginError.style.display = 'none';
            } else {
                elements.loginError.style.display = 'block';
            }
        }

        // Gestion de la déconnexion
        function handleLogout() {
            localStorage.removeItem('adminAuth');
            showLogin();
        }

        // Accès sécurité
        function handleSecurityLogin() {
            const password = elements.securityPassword.value;
            if (password === securityPassword) {
                elements.securityContent.classList.remove('hidden');
                elements.securityLoginBtn.style.display = 'none';
                elements.securityPassword.style.display = 'none';
                loadSecurityContent();
            } else {
                elements.securityError.style.display = 'block';
            }
        }

        // Afficher l'application
        function showApp() {
            elements.loginPage.style.display = 'none';
            elements.appContainer.classList.remove('hidden');
        }

        // Afficher l'écran de connexion
        function showLogin() {
            elements.loginPage.style.display = 'flex';
            elements.appContainer.classList.add('hidden');
            elements.loginPassword.value = '';
        }

        // Navigation entre les pages
        function navigateTo(pageId) {
            elements.pageTitle.textContent = getPageTitle(pageId);
            elements.pages.forEach(page => page.classList.remove('active'));
            document.getElementById(`${pageId}-page`).classList.add('active');
            elements.menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === pageId || item.id === `${pageId}-menu`) {
                    item.classList.add('active');
                }
            });
            if (pageId === 'dashboard') loadDashboard();
            else if (pageId === 'orders') loadOrders();
            else if (pageId === 'products') loadProducts();
            else if (pageId === 'stats') loadStats();
            else if (pageId === 'security') {
                elements.securityContent.classList.add('hidden');
                elements.securityLoginBtn.style.display = 'block';
                elements.securityPassword.style.display = 'block';
            }
            else if (pageId === 'notifications') loadNotifications();
        }

        // Obtenir le titre de la page
        function getPageTitle(pageId) {
            const titles = {
                'dashboard': 'Tableau de bord',
                'orders': 'Gestion des commandes',
                'products': 'Gestion des produits',
                'stats': 'Statistiques de vente',
                'security': 'Paramètres de sécurité',
                'notifications': 'Notifications'
            };
            return titles[pageId] || 'Tableau de bord';
        }

        // Chargement des données
        async function loadData() {
            try {
                const securityDoc = await db.collection('admin').doc('security').get();
                if (securityDoc.exists) {
                    const data = securityDoc.data();
                    adminPassword = data.password || '0000';
                    deleteCode = data.deleteCode || '0000';
                    securityPassword = data.securityPassword || '1111';
                    elements.adminPasswordInput.value = adminPassword;
                    elements.deleteCodeInput.value = deleteCode;
                    elements.securityPasswordInput.value = securityPassword;
                } else {
                    await db.collection('admin').doc('security').set({
                        password: '0000',
                        deleteCode: '0000',
                        securityPassword: '1111'
                    });
                }

                const ordersSnapshot = await db.collection('orders').orderBy('date', 'desc').get();
                orders = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                const productsSnapshot = await db.collection('products').get();
                products = productsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                const notificationsSnapshot = await db.collection('notifications').where('read', '==', false).get();
                notifications = notificationsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                updateNotifications();
                loadDashboard();
            } catch (error) {
                console.error('Erreur de chargement:', error);
            }
        }

        // Notifications push (simulé, car pas de FCM ici)
        function sendPushNotification(title, body) {
            if (Notification.permission === 'granted') {
                new Notification(title, { body });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification(title, { body });
                    }
                });
            }
        }

        // Mettre à jour les notifications
        function updateNotifications() {
            elements.notificationCount.textContent = notifications.length;
            if (notifications.length > 0) {
                sendPushNotification('Nouvelle commande', 'Une commande en attente de validation.');
            }
        }

        // Chargement du tableau de bord
        function loadDashboard() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayOrdersCount = orders.filter(order => order.date.toDate() >= today && order.status === 'completed').length;
            const todayRevenue = orders.filter(order => order.date.toDate() >= today && order.status === 'completed').reduce((sum, order) => sum + order.total, 0);
            const pendingOrdersCount = orders.filter(order => order.status === 'pending').length;
            const lowStockCount = products.filter(product => product.stock < 5).length;

            elements.todayOrders.textContent = todayOrdersCount;
            elements.todayRevenue.textContent = `${todayRevenue.toLocaleString()} FCFA`;
            elements.pendingOrders.textContent = pendingOrdersCount;
            elements.lowStock.textContent = lowStockCount;

            updateCharts();
            updateRecentOrders();
        }

        // Mettre à jour les graphiques (responsive)
        function updateCharts() {
            const salesData = {
                labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                datasets: [{ label: 'Ventes (FCFA)', data: [120000, 190000, 150000, 210000, 180000, 250000, 220000], backgroundColor: 'rgba(20, 40, 160, 0.2)', borderColor: 'rgba(20, 40, 160, 1)', borderWidth: 2, tension: 0.4 }]
            };

            const categoriesData = {
                labels: ['iPhone', 'Samsung', 'Tecno', 'Écouteurs', 'Chargeurs'],
                datasets: [{ data: [35, 25, 15, 12, 13], backgroundColor: ['rgba(20, 40, 160, 0.7)', 'rgba(255, 107, 0, 0.7)', 'rgba(0, 102, 255, 0.7)', 'rgba(58, 58, 58, 0.7)', 'rgba(255, 102, 0, 0.7)'] }]
            };

            if (window.salesChart) window.salesChart.destroy();
            const salesCtx = elements.salesChart.getContext('2d');
            window.salesChart = new Chart(salesCtx, { type: 'line', data: salesData, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true, ticks: { callback: v => v.toLocaleString() + ' FCFA' } } } } });

            if (window.categoriesChart) window.categoriesChart.destroy();
            const categoriesCtx = elements.categoriesChart.getContext('2d');
            window.categoriesChart = new Chart(categoriesCtx, { type: 'doughnut', data: categoriesData, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
        }

        // Update recent orders
        function updateRecentOrders() {
            const recent = orders.slice(0, 5);
            elements.recentOrders.innerHTML = recent.length ? recent.map(order => {
                const date = order.date.toDate().toLocaleDateString('fr-FR');
                const statusClass = order.status === 'completed' ? 'text-success' : order.status === 'rejected' ? 'text-danger' : 'text-warning';
                return `<tr><td>${order.id.substring(0, 8)}</td><td>${order.customerName}</td><td>${date}</td><td>${order.total.toLocaleString()} FCFA</td><td class="${statusClass}">${getStatusText(order.status)}</td><td><button class="btn btn-sm btn-primary view-order-btn" data-id="${order.id}">Voir</button></td></tr>`;
            }).join('') : '<tr><td colspan="6" class="text-center">Aucune commande récente</td></tr>';
            document.querySelectorAll('.view-order-btn').forEach(btn => btn.addEventListener('click', e => showOrderDetails(e.target.dataset.id)));
        }

        function getStatusText(status) {
            return { pending: 'En attente', completed: 'Validée', rejected: 'Rejetée' }[status] || status;
        }

        // Show order details
        function showOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            const date = order.date.toDate().toLocaleDateString('fr-FR');
            const itemsHtml = order.items.map(item => `<div style="display:flex;justify-content:space-between;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #eee;"><div><div style="font-weight:500;">${item.product.name}</div><div style="font-size:0.9rem;color:#666;">${item.quantity} x ${item.product.salePrice || item.product.normalPrice} FCFA</div></div><div style="font-weight:500;">${(item.quantity * (item.product.salePrice || item.product.normalPrice)).toLocaleString()} FCFA</div></div>`).join('');
            elements.orderDetailContent.innerHTML = `
                <div style="margin-bottom:20px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:15px;">
                        <div><div style="font-weight:500;">N° de commande</div><div>${order.id}</div></div>
                        <div><div style="font-weight:500;">Date</div><div>${date}</div></div>
                    </div>
                    <div style="margin-bottom:15px;"><div style="font-weight:500;">Client</div><div>${order.customerName}</div><div>${order.customerPhone}</div>${order.customerEmail ? `<div>${order.customerEmail}</div>` : ''}${order.customerAddress ? `<div>${order.customerAddress}</div>` : ''}</div>
                    <div style="margin-bottom:15px;"><div style="font-weight:500;">Articles</div>${itemsHtml}</div>
                    <div style="border-top:2px solid #eee;padding-top:15px;"><div style="display:flex;justify-content:space-between;font-weight:500;"><div>Total</div><div>${order.total.toLocaleString()} FCFA</div></div></div>
                </div>
            `;
            elements.orderDetailModal.style.display = 'flex';
            document.getElementById('validate-order-btn').onclick = () => updateOrderStatus(orderId, 'completed');
            document.getElementById('reject-order-btn').onclick = () => updateOrderStatus(orderId, 'rejected');
            document.getElementById('close-order-btn').onclick = closeModals;
            if (order.status !== 'pending') {
                document.getElementById('validate-order-btn').style.display = 'none';
                document.getElementById('reject-order-btn').style.display = 'none';
            } else {
                document.getElementById('validate-order-btn').style.display = 'inline-block';
                document.getElementById('reject-order-btn').style.display = 'inline-block';
            }
        }

        // Update order status
        async function updateOrderStatus(orderId, status) {
            try {
                await db.collection('orders').doc(orderId).update({ status });
                const index = orders.findIndex(o => o.id === orderId);
                if (index > -1) orders[index].status = status;
                if (status !== 'pending') {
                    const notifIndex = notifications.findIndex(n => n.orderId === orderId);
                    if (notifIndex > -1) {
                        await db.collection('notifications').doc(notifications[notifIndex].id).update({ read: true });
                        notifications.splice(notifIndex, 1);
                    }
                }
                loadDashboard();
                if (document.getElementById('orders-page').classList.contains('active')) loadOrders();
                if (document.getElementById('notifications-page').classList.contains('active')) loadNotifications();
                closeModals();
                showNotification(`Commande ${status === 'completed' ? 'validée' : 'rejetée'} avec succès`, 'success');
                sendPushNotification('Commande mise à jour', `Commande ${orderId} ${status === 'completed' ? 'validée' : 'rejetée'}.`);
            } catch (error) {
                console.error('Erreur update status:', error);
                showNotification('Erreur mise à jour', 'error');
            }
        }

        // Load orders
        function loadOrders() {
            filterOrders();
        }

        // Filter orders
        function filterOrders() {
            const statusFilter = document.getElementById('order-status-filter').value;
            const searchText = document.getElementById('order-search').value.toLowerCase();
            let filtered = orders;
            if (statusFilter !== 'all') filtered = filtered.filter(o => o.status === statusFilter);
            if (searchText) filtered = filtered.filter(o => o.id.toLowerCase().includes(searchText) || o.customerName.toLowerCase().includes(searchText) || o.customerPhone.toLowerCase().includes(searchText));
            displayOrders(filtered);
        }

        // Display orders
        function displayOrders(ordersToDisplay) {
            elements.ordersTable.innerHTML = ordersToDisplay.length ? ordersToDisplay.map(order => {
                const date = order.date.toDate().toLocaleDateString('fr-FR');
                const statusClass = order.status === 'completed' ? 'text-success' : order.status === 'rejected' ? 'text-danger' : 'text-warning';
                return `<tr><td>${order.id}</td><td>${order.customerName}</td><td>${order.customerPhone}</td><td>${date}</td><td>${order.total.toLocaleString()} FCFA</td><td class="${statusClass}">${getStatusText(order.status)}</td><td><button class="btn btn-sm btn-primary view-order-btn" data-id="${order.id}">Voir</button></td></tr>`;
            }).join('') : '<tr><td colspan="7" class="text-center">Aucune commande trouvée</td></tr>';
            document.querySelectorAll('.view-order-btn').forEach(btn => btn.addEventListener('click', e => showOrderDetails(e.target.dataset.id)));
        }

        // Download PDF
        function downloadOrders(status) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const filteredOrders = orders.filter(o => o.status === status);
            let y = 20;
            doc.text('Liste des commandes ' + (status === 'completed' ? 'validées' : 'rejetées'), 20, y);
            y += 10;
            filteredOrders.forEach(order => {
                doc.text(`ID: ${order.id} | Client: ${order.customerName} | Téléphone: ${order.customerPhone} | Date: ${order.date.toDate().toLocaleDateString('fr-FR')} | Montant: ${order.total} FCFA | Statut: ${getStatusText(order.status)}`, 20, y);
                y += 10;
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });
            doc.save(`commandes_${status}.pdf`);
        }

        // Load products
        function loadProducts() {
            filterProducts();
        }

        // Filter products
        function filterProducts() {
            const categoryFilter = document.getElementById('product-category-filter').value;
            const stockFilter = document.getElementById('product-stock-filter').value;
            const searchText = document.getElementById('product-search').value.toLowerCase();
            let filtered = products;
            if (categoryFilter !== 'all') filtered = filtered.filter(p => p.category === categoryFilter);
            if (stockFilter !== 'all') {
                if (stockFilter === 'low') filtered = filtered.filter(p => p.stock < 5);
                else if (stockFilter === 'medium') filtered = filtered.filter(p => p.stock >= 5 && p.stock < 15);
                else if (stockFilter === 'high') filtered = filtered.filter(p => p.stock >= 15);
            }
            if (searchText) filtered = filtered.filter(p => p.name.toLowerCase().includes(searchText) || p.category.toLowerCase().includes(searchText) || p.description.toLowerCase().includes(searchText));
            displayProducts(filtered);
        }

        // Display products
        function displayProducts(productsToDisplay) {
            elements.productsGrid.innerHTML = productsToDisplay.length ? productsToDisplay.map(product => {
                const stockClass = product.stock < 5 ? 'stock-low' : product.stock < 15 ? 'stock-medium' : 'stock-high';
                const stockText = product.stock < 5 ? 'Stock bas' : product.stock < 15 ? 'Stock moyen' : 'En stock';
                const price = product.salePrice || product.normalPrice;
                const img = product.images && product.images.length ? `<img src="${product.images[0]}" alt="${product.name}">` : `<i class="fas fa-box-open" style="font-size:3rem;color:#ccc;"></i>`;
                return `
                    <div class="product-card">
                        <div class="product-actions">
                            <button class="btn btn-sm btn-primary edit-product-btn" data-id="${product.id}">Modifier</button>
                            <button class="btn btn-sm btn-danger delete-product-btn" data-id="${product.id}">Supprimer</button>
                        </div>
                        <div class="product-image">${img}</div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">${price.toLocaleString()} FCFA</div>
                            <div class="product-stock"><span>Stock: ${product.stock}</span><span class="stock-badge ${stockClass}">${stockText}</span></div>
                        </div>
                    </div>
                `;
            }).join('') : '<div class="text-center">Aucun produit trouvé</div>';
            document.querySelectorAll('.edit-product-btn').forEach(btn => btn.addEventListener('click', e => showAddProductModal(e.target.dataset.id)));
            document.querySelectorAll('.delete-product-btn').forEach(btn => btn.addEventListener('click', e => deleteProduct(e.target.dataset.id)));
        }

        // Show add/edit product modal
        async function showAddProductModal(productId) {
            editingProductId = productId;
            const isEdit = !!productId;
            document.getElementById('product-modal-title').textContent = isEdit ? 'Modifier le produit' : 'Ajouter un produit';
            if (isEdit) {
                const product = products.find(p => p.id === productId);
                document.getElementById('product-name').value = product.name || '';
                document.getElementById('product-brand').value = product.brand || '';
                document.getElementById('product-category').value = product.category || 'iphone';
                document.getElementById('product-normal-price').value = product.normalPrice || '';
                document.getElementById('product-sale-price').value = product.salePrice || '';
                document.getElementById('product-discount').value = product.discount || '';
                document.getElementById('product-stock').value = product.stock || '';
                document.getElementById('product-delivery').value = product.delivery || 'free';
                document.getElementById('product-flash-sale').checked = product.flashSale || false;
                document.getElementById('char-os').value = product.characteristics?.os || '';
                document.getElementById('char-storage').value = product.characteristics?.storage || '';
                document.getElementById('char-ram').value = product.characteristics?.ram || '';
                document.getElementById('char-screen').value = product.characteristics?.screen || '';
                document.getElementById('char-model').value = product.characteristics?.model || '';
                document.getElementById('char-tech').value = product.characteristics?.tech || '';
                document.getElementById('char-colors').value = product.characteristics?.colors || '';
                document.getElementById('char-battery').value = product.characteristics?.battery || '';
                document.getElementById('char-camera').value = product.characteristics?.camera || '';
                document.getElementById('product-description').value = product.description || '';
                document.getElementById('product-main-image').value = product.images?.[0] || '';
                previewMainImage();
                document.getElementById('product-additional-images').value = product.images?.slice(1).join(', ') || '';
                previewAdditionalImages();
            } else {
                // Reset form
                document.querySelectorAll('#product-modal input, #product-modal textarea, #product-modal select').forEach(el => el.value = el.type === 'checkbox' ? false : '');
                document.getElementById('product-category').value = 'iphone';
                document.getElementById('product-delivery').value = 'free';
                document.querySelectorAll('.image-preview').forEach(el => el.innerHTML = '');
            }
            elements.productModal.style.display = 'flex';
        }

        // Preview images
        function previewMainImage() {
            const url = document.getElementById('product-main-image').value;
            const preview = document.getElementById('main-image-preview');
            preview.innerHTML = url ? `<img src="${url}" alt="Preview">` : '';
        }

        function previewAdditionalImages() {
            const urls = document.getElementById('product-additional-images').value.split(',').map(u => u.trim()).filter(u => u);
            const preview = document.getElementById('additional-images-preview');
            preview.innerHTML = urls.map(u => `<img src="${u}" alt="Preview">`).join('');
        }

        function addImageInput() {
            const input = document.createElement('input');
            input.type = 'url';
            input.className = 'form-control';
            input.placeholder = 'https://...';
            input.addEventListener('input', previewAdditionalImages);
            document.getElementById('product-additional-images').parentNode.appendChild(input);
        }

        // Save product
        async function saveProduct() {
            const name = document.getElementById('product-name').value;
            const brand = document.getElementById('product-brand').value;
            const category = document.getElementById('product-category').value;
            const normalPrice = parseInt(document.getElementById('product-normal-price').value);
            const salePrice = parseInt(document.getElementById('product-sale-price').value);
            const discount = parseInt(document.getElementById('product-discount').value);
            const stock = parseInt(document.getElementById('product-stock').value);
            const delivery = document.getElementById('product-delivery').value;
            const flashSale = document.getElementById('product-flash-sale').checked;
            const characteristics = {
                os: document.getElementById('char-os').value,
                storage: document.getElementById('char-storage').value,
                ram: document.getElementById('char-ram').value,
                screen: document.getElementById('char-screen').value,
                model: document.getElementById('char-model').value,
                tech: document.getElementById('char-tech').value,
                colors: document.getElementById('char-colors').value,
                battery: document.getElementById('char-battery').value,
                camera: document.getElementById('char-camera').value
            };
            const description = document.getElementById('product-description').value;
            const mainImage = document.getElementById('product-main-image').value;
            const additionalImages = document.getElementById('product-additional-images').value.split(',').map(u => u.trim()).filter(u => u);
            const images = mainImage ? [mainImage, ...additionalImages] : additionalImages;

            if (!name || !normalPrice || !stock) {
                showNotification('Champs obligatoires manquants', 'error');
                return;
            }

            try {
                const productData = {
                    name, brand, category, normalPrice, stock, delivery, flashSale, characteristics, description, images, dateAdded: new Date()
                };
                if (salePrice) productData.salePrice = salePrice;
                if (discount) productData.discount = discount;

                if (editingProductId) {
                    await db.collection('products').doc(editingProductId).update(productData);
                } else {
                    await db.collection('products').add(productData);
                }

                const productsSnapshot = await db.collection('products').get();
                products = productsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                filterProducts();
                closeModals();
                showNotification(`${editingProductId ? 'Produit mis à jour' : 'Produit ajouté'} avec succès`, 'success');
                await logActivity('Admin', `${editingProductId ? 'Mise à jour' : 'Ajout'} du produit ${name}`);
            } catch (error) {
                console.error('Erreur save product:', error);
                showNotification('Erreur sauvegarde produit', 'error');
            }
        }

        // Delete product
        async function deleteProduct(productId) {
            document.getElementById('delete-confirm-modal').dataset.target = 'product';
            document.getElementById('delete-confirm-modal').dataset.id = productId;
            elements.deleteConfirmModal.style.display = 'flex';
            document.getElementById('confirm-delete-btn').onclick = confirmDeleteProduct;
        }

        async function confirmDeleteProduct() {
            const code = document.getElementById('delete-confirm-code').value;
            if (code !== deleteCode) {
                showNotification('Code de suppression incorrect', 'error');
                return;
            }
            const productId = elements.deleteConfirmModal.dataset.id;
            try {
                await db.collection('products').doc(productId).delete();
                const productsSnapshot = await db.collection('products').get();
                products = productsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                filterProducts();
                closeModals();
                showNotification('Produit supprimé', 'success');
                await logActivity('Admin', `Suppression du produit ID ${productId}`);
            } catch (error) {
                console.error('Erreur delete product:', error);
                showNotification('Erreur suppression', 'error');
            }
        }

        // Load stats
        function loadStats() {
            // Fictive data
            elements.statsOrders.textContent = '42';
            elements.statsRevenue.textContent = '1 250 000 FCFA';
            elements.statsProductsSold.textContent = '78';
            elements.statsAvgCart.textContent = '29 762 FCFA';
            updateStatsCharts();
            updateSalesDetails();
        }

        // Update stats charts (responsive)
        function updateStatsCharts() {
            const salesData = { labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'], datasets: [{ label: 'Ventes (FCFA)', data: [1200000,1900000,1500000,2100000,1800000,2500000,2200000,2400000,2300000,2600000,2800000,3000000], backgroundColor: 'rgba(20, 40, 160, 0.2)', borderColor: 'rgba(20, 40, 160, 1)', borderWidth: 2, tension: 0.4 }] };
            const productsData = { labels: ['iPhone 13', 'Samsung S22', 'AirPods Pro', 'Chargeur USB-C', 'PowerBank'], datasets: [{ label: 'Quantité vendue', data: [25,18,15,12,8], backgroundColor: 'rgba(255, 107, 0, 0.7)', borderColor: 'rgba(255, 107, 0, 1)', borderWidth: 1 }] };

            if (window.statsSalesChart) window.statsSalesChart.destroy();
            const statsSalesCtx = document.getElementById('stats-sales-chart').getContext('2d');
            window.statsSalesChart = new Chart(statsSalesCtx, { type: 'bar', data: salesData, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true, ticks: { callback: v => (v / 1000000).toFixed(1) + ' M' } } } } });

            if (window.statsProductsChart) window.statsProductsChart.destroy();
            const statsProductsCtx = document.getElementById('stats-products-chart').getContext('2d');
            window.statsProductsChart = new Chart(statsProductsCtx, { type: 'bar', data: productsData, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { position: 'top' } } } });
        }

        // Update sales details
        function updateSalesDetails() {
            const data = [{ product: 'iPhone 13', quantity: 25, revenue: 1250000, stock: 12 }, { product: 'Samsung S22', quantity: 18, revenue: 900000, stock: 8 }, { product: 'AirPods Pro', quantity: 15, revenue: 450000, stock: 5 }, { product: 'Chargeur USB-C', quantity: 12, revenue: 60000, stock: 20 }, { product: 'PowerBank', quantity: 8, revenue: 160000, stock: 15 }];
            elements.salesDetails.innerHTML = data.map(item => `<tr><td>${item.product}</td><td>${item.quantity}</td><td>${item.revenue.toLocaleString()} FCFA</td><td>${item.stock}</td></tr>`).join('');
        }

        // Delete all sales (fictive)
        async function deleteAllSales() {
            if (confirm('Supprimer tous les détails des ventes?')) {
                elements.salesDetails.innerHTML = '<tr><td colspan="4" class="text-center">Aucune donnée</td></tr>';
                showNotification('Détails des ventes supprimés', 'success');
            }
        }

        // Load notifications
        function loadNotifications() {
            elements.notificationsList.innerHTML = notifications.length ? notifications.map(notif => {
                const order = orders.find(o => o.id === notif.orderId);
                if (!order) return '';
                return `<div class="notification-item"><h4>Commande ${order.id}</h4><p>Client: ${order.customerName} - Montant: ${order.total} FCFA</p><button class="btn btn-primary" onclick="showOrderDetails('${order.id}')">Voir détails</button></div>`;
            }).join('') : '<div class="text-center">Aucune notification</div>';
        }

        // Load security content
        async function loadSecurityContent() {
            const logSnapshot = await db.collection('activityLog').orderBy('timestamp', 'desc').limit(50).get();
            elements.activityLog.innerHTML = logSnapshot.docs.length ? logSnapshot.docs.map(doc => {
                const data = doc.data();
                return `<tr><td>${data.timestamp.toDate().toLocaleString('fr-FR')}</td><td>${data.user}</td><td>${data.action}</td></tr>`;
            }).join('') : '<tr><td colspan="3" class="text-center">Aucune activité récente</td></tr>';
        }

        // Save security
        async function saveSecuritySettings() {
            const newAdminPass = elements.adminPasswordInput.value;
            const newDeleteCode = elements.deleteCodeInput.value;
            const newSecPass = elements.securityPasswordInput.value;
            if (!newAdminPass || !newDeleteCode || !newSecPass) {
                showNotification('Champs obligatoires', 'error');
                return;
            }
            try {
                await db.collection('admin').doc('security').update({ password: newAdminPass, deleteCode: newDeleteCode, securityPassword: newSecPass });
                adminPassword = newAdminPass;
                deleteCode = newDeleteCode;
                securityPassword = newSecPass;
                showNotification('Paramètres enregistrés', 'success');
                await logActivity('Admin', 'Mise à jour des paramètres de sécurité');
            } catch (error) {
                console.error('Erreur save security:', error);
                showNotification('Erreur sauvegarde', 'error');
            }
        }

        // Log activity
        async function logActivity(user, action) {
            await db.collection('activityLog').add({ user, action, timestamp: new Date() });
        }

        // Delete activity log
        async function deleteActivityLog() {
            const code = prompt('Code de suppression pour journal:');
            if (code === deleteCode) {
                const snapshot = await db.collection('activityLog').get();
                const batch = db.batch();
                snapshot.docs.forEach(doc => batch.delete(doc.ref));
                await batch.commit();
                loadSecurityContent();
                showNotification('Journal supprimé', 'success');
                await logActivity('Admin', 'Suppression du journal d\'activité');
            } else {
                showNotification('Code incorrect', 'error');
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notif = document.createElement('div');
            notif.style.cssText = `position:fixed;bottom:20px;right:20px;padding:10px 20px;border-radius:5px;color:white;z-index:3000;box-shadow:0 3px 10px rgba(0,0,0,0.2);background:${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : type === 'warning' ? 'var(--warning)' : 'var(--info)'};`;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => document.body.removeChild(notif), 3000);
        }

        // Confirm delete general
        document.getElementById('confirm-delete-btn').addEventListener('click', () => {
            const target = elements.deleteConfirmModal.dataset.target;
            if (target === 'product') confirmDeleteProduct();
        });
        document.getElementById('cancel-delete-btn').addEventListener('click', closeModals);

        // Init
        initApp();
        if ('Notification' in window) Notification.requestPermission();
    </script>
</body>
</html>
